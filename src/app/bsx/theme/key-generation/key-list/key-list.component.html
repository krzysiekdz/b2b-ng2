<div *ngIf="error" class="m-alert m-alert--outline m-alert--outline-2x alert alert-danger alert-dismissible fade show" role="alert">
    <strong>Błąd!</strong> Nastąpił błąd podczas wczytywania danych. Spróbuj ponownie za chwilę, a jeśli błąd będzie się powtarzał, skontaktuj się z nami.
</div>

 <!-- <div *ngIf="err_delete" class="m-alert m-alert--outline m-alert--outline-2x alert alert-danger alert-dismissible fade show anim1" role="alert">
    <strong>Błąd!</strong>Nastąpił błąd podczas próby usuwania klucza. Spróbuj ponownie za chwilę, a jeśli błąd będzie się powtarzał, skontaktuj się z nami.
</div> -->

<div *ngIf="msg_add" class="m-alert m-alert--outline m-alert--outline-2x alert alert-success alert-dismissible fade show anim1" role="alert">
    Klucz wygenerowany pomyślnie.
</div>

<div *ngIf="msg_edit" class="m-alert m-alert--outline m-alert--outline-2x alert alert-success alert-dismissible fade show anim1" role="alert">
    Dane zmodyfikowane pomyślnie.
</div>


<div class="m-portlet m-portlet--mobile">
	<!-- <div class="m-portlet__head">
		<div class="m-portlet__head-caption">
			<div class="m-portlet__head-title">
				<h3 class="m-portlet__head-text">
					Basic Portlet
					<small>
						portlet sub title
					</small>
				</h3>
			</div>
		</div>
	</div> -->
	<div class="m-portlet__body">
		Kwota kredytu kupieckiego <span style="font-weight: bold;"> {{credit_data.credit | number:'1.2-2'}} PLN</span>. Wykorzystano <span class="m--font-danger"> {{credit_data.price_sum | number:'1.2-2'}} PLN</span>. Poziom rabatowy <span style="font-weight: bold;"> {{credit_data.discount}} %</span>.
	</div>
</div>


<div  class="m-portlet m-portlet--mobile" >

<div class="m-portlet__head">
	<div class="m-portlet__head-caption">
		<div class="m-portlet__head-title">
			<h3 class="m-portlet__head-text">
				Wygenerowane klucze do programów
			</h3>
		</div>
	</div>
	<div class="m-portlet__head-tools">
		<ul class="m-portlet__nav">
			<li class="m-portlet__nav-item">
				<div class="m-dropdown m-dropdown--inline m-dropdown--arrow m-dropdown--align-right m-dropdown--align-push" data-dropdown-toggle="hover" aria-expanded="true">
					<a href="javascript:;" class="
m-portlet__nav-link m-portlet__nav-link--icon m-portlet__nav-link--icon-xl m-dropdown__toggle">
						<i class="la la-plus m--hide"></i>
						<i class="la la-ellipsis-h m--font-brand"></i>
					</a>
					<div class="m-dropdown__wrapper">
						<span class="m-dropdown__arrow m-dropdown__arrow--right m-dropdown__arrow--adjust"></span>
						<div class="m-dropdown__inner">
							<div class="m-dropdown__body">
								<div class="m-dropdown__content">
									<ul class="m-nav">
										<li class="m-nav__section m-nav__section--first">
											<span class="m-nav__section-text">
												Operacje
											</span>
										</li>
										<li class="m-nav__item">
											<a href="javascript:;" class="m-nav__link" (click)="refresh();">
												<i class="m-nav__link-icon flaticon-refresh"></i>
												<span class="m-nav__link-text">
													Odswież listę
												</span>
											</a>
										</li>
										<li class="m-nav__item">
											<a routerLink="//index/keygen/add" class="m-nav__link">
												<i class="m-nav__link-icon la la-key"></i>
												<span class="m-nav__link-text">
													Generuj klucz
												</span>
											</a>
										</li>
										<!-- <li class="m-nav__item">
											<a href="" class="m-nav__link">
												<i class="m-nav__link-icon flaticon-multimedia-2"></i>
												<span class="m-nav__link-text">
													Upload File
												</span>
											</a>
										</li>
										<li class="m-nav__section">
											<span class="m-nav__section-text">
												Useful Links
											</span>
										</li>
										<li class="m-nav__item">
											<a href="" class="m-nav__link">
												<i class="m-nav__link-icon flaticon-info"></i>
												<span class="m-nav__link-text">
													FAQ
												</span>
											</a>
										</li>
										<li class="m-nav__item">
											<a href="" class="m-nav__link">
												<i class="m-nav__link-icon flaticon-lifebuoy"></i>
												<span class="m-nav__link-text">
													Support
												</span>
											</a>
										</li>
										<li class="m-nav__separator m-nav__separator--fit m--hide"></li>
										<li class="m-nav__item m--hide">
											<a href="#" class="btn btn-outline-danger m-btn m-btn--pill m-btn--wide btn-sm">
												Submit
											</a>
										</li> -->
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</li>
		</ul>
	</div>
</div>
<div class="m-portlet__body">
	<!--begin: Search Form -->
	<form >
	<div class="m-form m-form--label-align-right m--margin-top-20 m--margin-bottom-30">
		<div class="row align-items-center">
			<div class="col-xl-8 order-2 order-xl-1">
			
				<div  class="form-group m-form__group row align-items-center row">
					<div class="col-md-4" >
					   <div class="form-group m-form__group">
							<div class="m-form__label">
								<label class="m-label m-label--single" >
									Szukaj:
								</label>
							</div>
                            <div class="m-input-icon m-input-icon--left">
								<input type="text" name="search_query" [(ngModel)]="search_query" (input)="search()" class="form-control m-input " placeholder="..." id="m_form_search">
								<span class="m-input-icon__icon m-input-icon__icon--left">
									<span>
										<i class="la la-search"></i>
									</span>
								</span>
							</div>
						</div>
						<div class="d-md-none m--margin-bottom-10"></div>
					</div>

					

					<div class="col-md-4" >
						<div class="form-group m-form__group">
							<div class="m-form__label">
								<label class="m-label m-label--single" >
									Program:
								</label>
							</div>
                            <select  class="form-control m-select2  " id="m_select2_1"  name="select1" [(ngModel)]="selectedProgram">
								<option *ngFor="let p of programs;" [ngValue]="p" >
									{{p.name}}
								</option>
							</select>
						</div>
						<div class="d-md-none m--margin-bottom-10"></div>
					</div>

					<div class="col-md-4" >
                        <div class="m-form__group">
                            <label class="m-checkbox ">
                                <input type="checkbox" name="ch1"  [(ngModel)]="filterPrepaid" (change)="onFilterChange()" >
                                Opłacone
                                <span></span>
                            </label>
                            <br>
                            <label class="m-checkbox ">
                                <input type="checkbox" name="ch2" [(ngModel)]="filterEndDate"  (change)="onFilterChange()"  >
                                Kończące się
                                <span></span>
                            </label>
                        </div>
                    </div>

                 </div>
			
			</div>
			

			<div class="col-xl-4 order-1 order-xl-2 m--align-right">
				<a routerLink="//index/keygen/add" class="btn btn-accent m-btn m-btn--custom m-btn--icon m-btn--air">
					<span>
						<i class="flaticon la la-key"></i>
						<span>
							Generuj nowy
						</span>
					</span>
				</a>
				<div class="m-separator m-separator--dashed d-xl-none"></div>
			</div>
		</div>
	</div>
	</form>
<!--end: Search Form -->



<!--begin: Datatable -->
<div  class="m_datatable m-datatable m-datatable--default m-datatable--loaded" id="column_rendering" style="" >
    <table class="m-datatable__table" id="m-datatable--1335391329591" style="display: block; height: auto; overflow-x: auto;" >
        <thead class="m-datatable__head">
            <tr class="m-datatable__row" style="height: 56px;">
                <!-- <th data-field="RecordID" class="m-datatable__cell--center m-datatable__cell m-datatable__cell--check m-datatable__cell--sort">
                    <span style="width: 40px;">
                        <label class="m-checkbox m-checkbox--single m-checkbox--all m-checkbox--solid m-checkbox--brand">
                            <input type="checkbox"><span></span>
                        </label>
                    </span>
                </th> -->
                <!--  <th data-field="CompanyAgent" class="m-datatable__cell m-datatable__cell--sort"><span style="width: 40px;">ID</span>
                </th> -->
                <th data-field="f1" class="m-datatable__cell w1_hide header-sortable" (click)="setOrderBy('id')"><span class="w1" >Klucz<i *ngIf="orderby=='id'" class="la" [ngClass]="{'la-arrow-down':!orderbydesc, 'la-arrow-up':orderbydesc}"></i></span>
                </th>
                <th data-field="f2" class="m-datatable__cell" ><span class="w2">Program</span>
                </th>
                <th data-field="f3" class="m-datatable__cell header-sortable" (click)="setOrderBy('pname')"><span class="w3 " >Dane klienta<i *ngIf="orderby=='pname'" class="la" [ngClass]="{'la-arrow-down':!orderbydesc, 'la-arrow-up':orderbydesc}"></i></span>
                </th>
                <th data-field="f4" class="m-datatable__cell w4_hide header-sortable" (click)="setOrderBy('frozdate')"><span class="w4 " >Opłacono<i *ngIf="orderby=='frozdate'" class="la" [ngClass]="{'la-arrow-down':!orderbydesc, 'la-arrow-up':orderbydesc}"></i></span>
                </th>
                <th data-field="f5" class="m-datatable__cell w5_hide header-sortable" (click)="setOrderBy('fstart')"><span class="w5 " >Data aktywacji<i *ngIf="orderby=='fstart'" class="la" [ngClass]="{'la-arrow-down':!orderbydesc, 'la-arrow-up':orderbydesc}"></i></span>
                </th> 
                <th data-field="f6" class="m-datatable__cell w6_hide header-sortable" (click)="setOrderBy('fdate')"><span class="w6 " >Ważność<i *ngIf="orderby=='fdate'" class="la" [ngClass]="{'la-arrow-down':!orderbydesc, 'la-arrow-up':orderbydesc}"></i></span>
                </th>
                <th data-field="f7" class="m-datatable__cell " ><span class="w7"></span>
                </th>
            </tr>
        </thead>
        <tbody class="m-datatable__body" style="" *ngIf="!error">

        <!-- m_datatable__row--hover -->

            <tr *ngFor="let k of keys; even as e;" data-row="0" class="m-datatable__row " [ngClass]="{'m-datatable__row--even':e,'m-datatable__row--hover':(mouseOnElement===k)}" (mouseleave)="deselectMouseOnElement()"  (mouseenter)="setMouseOnElement(k)" style="height: 62px;" >
               <!--  <td data-field="RecordID" class="m-datatable__cell--center m-datatable__cell m-datatable__cell--check">
                    <span style="width: 40px;">
                        <label class="m-checkbox m-checkbox--single m-checkbox--solid m-checkbox--brand">
                        <input type="checkbox" value="{{k.id}}">
                        <span></span>
                        </label>
                    </span>
                </td> -->
                <!-- <td data-field="ID" class="m-datatable__cell">
                    <span style="width: 40px; font-weight: bold;">
                        {{k.id}}
                    </span>
                </td> -->
                <td data-field="f1" class="m-datatable__cell w1_hide "  >
                	<div class="w1" >
	                    <div style="" class="m--font-bolder">
	                        {{k.serial}}
	                    </div>
	                    <div *ngIf="k.trial" class="m--font-info" style="" >
	                        Wersja testowa
	                    </div>
	                    <div  *ngIf="!k.trial" class="" style=" " >
	                        cena: {{k.price | number:'1.2-2'}}  PLN
	                    </div>
                    </div>
                </td>
                <td data-field="f2" class="m-datatable__cell ">
                	<div class="w2">
	                    <div style=" " class="m--font-bolder">
	                        {{k.caption}}
	                    </div>
	                    <div style="">
	                        stanowisk:  <span class="m-badge m-badge--brand"> {{k.items}} </span>
	                    </div>
                    </div>
                </td>
                <td data-field="f3" class="m-datatable__cell clickable" (click)="goToEdit(k.id)" title="Edytuj">
                	<div class="w3" >	
	                    <div style="" >
	                        <span *ngIf="!k.is_client_name" >-- brak --</span>
	                        <span class="m--font-bolder">{{k.client_name}}</span>
	                        <div *ngIf="k.is_client_nip">NIP: {{k.client_nip}}</div>
	                    </div>
	                    <div style="">
	                        {{k.client_postcode}} {{k.client_city}} <span *ngIf="k.is_client_street">, {{k.client_street}} {{k.client_street_n1}}</span>
	                    </div>
                    </div>
                </td>
                <td data-field="f4" class="m-datatable__cell w4_hide" >
                    <div class="w4">
                    	<span *ngIf="!k.trial">
	                        <span *ngIf="!k.prepaid" class="m-badge m-badge--wide m-badge--warning">Nie</span>
	                        <span *ngIf="k.prepaid" class="m-badge m-badge--wide m-badge--success">Tak</span>
                        </span>
	                    <span *ngIf="k.trial" class="m--font-info">Testowy</span>
                    </div>
                </td>
                <td data-field="f5" class="m-datatable__cell w5_hide" >
                    <div class="w5">
                        <span *ngIf="!k.date_start" class="">-- brak --</span>
                        <span *ngIf="k.date_start" class=""> {{k.date_start}} </span>
                    </div>
                </td>
                <td data-field="f6" class="m-datatable__cell w6_hide">
                    <div class="w6">
                    	<span *ngIf="k.date_end"  [ngClass]="{'m--font-warning':k.expi==1,'m--font-danger':k.expi==2}"> 
                    		<span *ngIf="k.expi>0" class="m-badge m-badge--dot m-animate-blink" [ngClass]="{'m-badge--danger':k.expi==2,'m-badge--warning':k.expi==1}"></span>
                    		<span *ngIf="k.expi==0">&nbsp;</span>
                    		{{k.date_end}} 
                    		<span *ngIf="k.expi>0" class="m-badge m-badge--dot m-animate-blink" [ngClass]="{'m-badge--danger':k.expi==2,'m-badge--warning':k.expi==1}"></span>
                    	</span>
                        <div *ngIf="!k.date_end" class="">od aktywacji: <br> <span class="m--font-bolder"> {{k.date_label}} </span> </div>
                        
                    </div>
                </td>
               
                <td data-field="Actions" class="m-datatable__cell " >
                    <span style="overflow: visible; " class="w7">                                     
                        <a routerLink="//index/keygen/edit/{{k.id}}" class="m-portlet__nav-link btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill" title="Edytuj">
                            <i class="la la-edit"></i>                      
                        </a>        
                        <a href="javascript:;" (click)="setKeyToDelete(k)"  class="btn m-btn m-btn--hover-danger m-btn--icon m-btn--icon-only m-btn--pill" title="Usuń" data-toggle="modal" data-target="#m_modal_1" >     
                            <i class="la la-trash" ></i>                           
                        </a>                        
                                                         
                    </span>
                </td>
            </tr>
        </tbody>
    </table>

<div class="m-datatable__pager m-datatable--paging-loaded clearfix">
    <ul class="m-datatable__pager-nav" *ngIf="pages_num>1" >
        <li *ngIf="(this_page  > 2)"><a title="Początek" class="m-datatable__pager-link m-datatable__pager-link--first" (click)="goToBegin();" ><i class="la la-angle-double-left"></i></a>
        </li>
        <li *ngIf="(this_page != 1)"><a title="Poprzedni" class="m-datatable__pager-link m-datatable__pager-link--prev" (click)="prev();" ><i class="la la-angle-left"></i></a>
        </li>

        <li *ngFor="let i of pages" >
        	<a class="m-datatable__pager-link m-datatable__pager-link-number" [ngClass]="{'m-datatable__pager-link--active':i==this_page}" (click)="goToPage(i)"  > {{i}} </a>
        </li>

        <li *ngIf="(this_page != pages_num)"><a title="Następny" class="m-datatable__pager-link m-datatable__pager-link--next" (click)="next();" ><i class="la la-angle-right"></i></a>
        </li>
        <li *ngIf="(this_page < pages_num-1)"><a title="Ostatni" class="m-datatable__pager-link m-datatable__pager-link--last" (click)="goToEnd();" ><i class="la la-angle-double-right"></i></a>
        </li>
    </ul>
    <div class="m-datatable__pager-info">
        <div class="btn-group bootstrap-select m-datatable__pager-size" style="width: 70px;">
            <button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" role="button" title="Wybierz rozmiar strony">
            	<span class="filter-option pull-left"> {{count_fetch}} </span>&nbsp;<span class="bs-caret"><span class="caret"></span></span>
            </button>
            <div class="dropdown-menu open" role="combobox">
                <ul class="dropdown-menu inner" role="listbox" aria-expanded="false">
                    <li *ngFor="let s of page_sizes; index as i;" data-original-index="0" [class.selected]="page_size_selected==i" (click)="setPageSize(i)" >
                    	<a tabindex="0"  data-tokens="null" role="option" aria-disabled="false">
                    		<span class="text"> {{s}} </span>
                    		<span class="glyphicon glyphicon-ok check-mark"></span>
                    	</a>
                    </li>
                </ul>
            </div>
        </div>
        <span class="m-datatable__pager-detail">Wyniki {{start_fetch}} - {{this_length+start_fetch-1}} z {{all_length}}  </span>
    </div>
</div>

</div>

		<!--end: Datatable -->
	</div>
</div>

		<!--Modal window - usuwanie klucza -->
<div class="modal fade" id="m_modal_1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">
					Usuwanie klucza
				</h5>
				<button type="button" style="cursor: pointer;" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">
						&times;
					</span>
				</button>
			</div>
			<div class="modal-body">
				<p>
					Czy na pewno usunąć klucz o numerze {{keyToDelete.serial}} wygenerowany dla {{keyToDelete.pname}} ?
				</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">
					Anuluj
				</button>
				<button type="button" (click)="delete(keyToDelete.id)" class="btn btn-primary" data-dismiss="modal" >
					Usuń
				</button>
			</div>
		</div>
	</div>
</div>

<div  class="modal fade"  id="m_modal_2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">
					<span >Nie można usunąć klucza!</span>
				</h5>
				<button type="button" style="cursor: pointer;" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">
						&times;
					</span>
				</button>
			</div>
			<div class="modal-body">
				Nie mozna usunąć klucza ponieważ został on już rozliczony bądź zarejestrowany.
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">
					Zamknij
				</button>
			</div>
		</div>
	</div>
</div>